<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign up - Sagittarum</title>
  <style>
:root{--primary-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--color-primary:#667eea;--color-text:#1f2937;--color-text-light:#6b7280;--color-white:#fff;--color-gray-200:#e5e7eb;--color-gray-300:#d1d5db;--radius-lg:.75rem;--radius-md:.5rem;--shadow-lg:0 10px 15px -3px rgba(0,0,0,.1)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);color:var(--color-text);min-height:100vh}
a{color:var(--color-primary);text-decoration:none}
button{font-family:inherit;cursor:pointer;border:none;outline:none}
input{font-family:inherit;outline:none}
input:focus{outline:2px solid var(--color-primary);outline-offset:2px}
.card{background:var(--color-white);border-radius:1rem;padding:1.5rem;box-shadow:var(--shadow-lg)}
.btn{font-weight:600;border-radius:var(--radius-lg);padding:.75rem;cursor:pointer;background:var(--primary-gradient);color:var(--color-white)}
.signup-page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1.5rem;position:relative}
.signup-page__bg{position:absolute;inset:0;background:radial-gradient(ellipse at top right,rgba(102,126,234,.2) 0%,transparent 50%);z-index:0}
.signup-page__content{position:relative;z-index:1;width:100%;max-width:420px}
.signup-card__header{text-align:center;margin-bottom:1.5rem}
.signup-card__title{background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:2.25rem;font-weight:700}
.signup-card__subtitle{color:var(--color-text-light)}
.signup-card__form{display:flex;flex-direction:column;gap:1rem}
.signup-card__field label{display:block;font-weight:600;font-size:.875rem;margin-bottom:.25rem}
.signup-card__field input{width:100%;padding:.75rem;border:2px solid var(--color-gray-200);border-radius:var(--radius-lg)}
.signup-card__radio-group{display:flex;gap:1rem}
.signup-card__radio{flex:1;display:flex;align-items:flex-start;gap:.5rem;cursor:pointer;font-weight:500;padding:.9rem .85rem;border-radius:var(--radius-lg);border:2px solid var(--color-gray-200);background:rgba(255,255,255,.9);transition:border-color .18s ease,box-shadow .18s ease,background .18s ease,transform .18s ease}
.signup-card__radio input{margin-top:.2rem;outline:none;box-shadow:none}
.signup-card__radio-content{display:flex;flex-direction:column;gap:.15rem}
.signup-card__radio-title{font-size:.9rem;font-weight:600}
.signup-card__radio-desc{font-size:.8rem;color:var(--color-text-light)}
.signup-card__radio--selected{border-color:var(--color-primary);background:linear-gradient(135deg,rgba(102,126,234,.06),rgba(118,75,162,.02));box-shadow:0 10px 25px rgba(148,163,184,.35);transform:translateY(-1px)}
.signup-card__response-wrapper{border:2px solid var(--color-gray-300);border-radius:var(--radius-md);overflow:hidden;background:#fafafa;min-height:60px}
.signup-card__response-frame{display:block;width:100%;min-height:60px;border:none;background:#fafafa}
.signup-card__footer{text-align:center;font-size:.875rem;color:var(--color-text-light)}
.signup-card__link{color:#2563eb;font-weight:600}
  </style>
</head>
<body>
  <div class="signup-page">
    <div class="signup-page__bg"></div>
    <div class="signup-page__content">
      <div class="card">
        <div class="signup-card__header">
          <h1 class="signup-card__title">Sagittarum</h1>
          <p class="signup-card__subtitle">Create an account</p>
        </div>
        <form id="signupForm" class="signup-card__form">
          <div class="signup-card__field">
            <label for="name">Name</label>
            <input id="name" type="text" required placeholder="Enter your full name" />
          </div>
          <div class="signup-card__field">
            <label for="email">Email</label>
            <input id="email" type="email" required placeholder="Enter your email" />
          </div>
          <div class="signup-card__field">
            <label for="password">Password</label>
            <input id="password" type="password" required minlength="6" placeholder="Enter password (min 6 characters)" />
          </div>
          <div class="signup-card__field">
            <label for="confirmPassword">Confirm Password</label>
            <input id="confirmPassword" type="password" required minlength="6" placeholder="Confirm your password" />
          </div>
          <div class="signup-card__field">
            <label>Account type</label>
            <div class="signup-card__radio-group">
              <label class="signup-card__radio signup-card__radio--selected">
                <input type="radio" name="accountType" value="student" checked />
                <span class="signup-card__radio-content">
                  <span class="signup-card__radio-title">Student</span>
                  <span class="signup-card__radio-desc">See assignments, submit work, and review AI feedback.</span>
                </span>
              </label>
              <label class="signup-card__radio">
                <input type="radio" name="accountType" value="teacher" />
                <span class="signup-card__radio-content">
                  <span class="signup-card__radio-title">Teacher</span>
                  <span class="signup-card__radio-desc">Create classes, post assignments, and review submissions.</span>
                </span>
              </label>
            </div>
          </div>
          <button type="submit" class="btn">Sign up</button>
          <div id="responseWrapper" class="signup-card__response-wrapper" style="display:none">
            <iframe id="responseFrame" title="API Response" class="signup-card__response-frame" sandbox="allow-same-origin"></iframe>
          </div>
          <p class="signup-card__footer">Already have an account? <a href="../signin/" class="signup-card__link">Sign in</a></p>
        </form>
      </div>
    </div>
  </div>
    <script>
(function(){
var SK='sagittarum_session',D=90*24*60*60*1000; // 90 days
function setSessionCookie(user){var data={user:user,expiresAt:Date.now()+D};var v=encodeURIComponent(JSON.stringify(data));var exp=new Date(Date.now()+D).toUTCString();document.cookie=SK+'='+v+'; expires='+exp+'; path=/';}
function getSessionFromCookie(){var name=SK+'=',c=document.cookie.split(';');for(var i=0;i<c.length;i++){var x=c[i].trim();if(x.indexOf(name)===0){try{var raw=decodeURIComponent(x.substring(name.length));var d=JSON.parse(raw);if(!d||!d.user||!d.expiresAt)return null;if(Date.now()>d.expiresAt){clearSessionCookie();return null;}return d.user;}catch(e){clearSessionCookie();return null;}}}return null;}
function clearSessionCookie(){document.cookie=SK+'=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';}
window.Sagittarum=window.Sagittarum||{};
window.Sagittarum.session={saveSession:setSessionCookie,getCurrentUser:getSessionFromCookie,clearSession:clearSessionCookie};
// Signup + token retrieval via backend webhooks
window.Sagittarum.auth={
  signup:function(n,e,p,r){
    // Create account
    return fetch('https://n8n.tail851803.ts.net/webhook/06d85bab-4626-479b-bb62-7955a09f67ac',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        username:(n||'').trim(),
        email:e,
        password:p,
        role:r
      })
    }).then(function(resp){return resp.text().then(function(text){
      return { raw:text, ok:resp.ok };
    });});
  },
  getToken:function(e,p){
    return fetch('https://n8n.tail851803.ts.net/webhook/e03d8d7e-3f92-4237-9469-a8ab4341b8b7',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        username:e.split('@')[0],
        password:p
      })
    }).then(function(resp){return resp.text().then(function(text){
      return { raw:text, ok:resp.ok };
    });});
  }
};
var user=window.Sagittarum.session.getCurrentUser();
if(user){location.href=user.role==='teacher'?'../teacher/':'../student/';return}
var form=document.getElementById('signupForm'),rw=document.getElementById('responseWrapper'),rf=document.getElementById('responseFrame');
var radios=form.querySelectorAll('.signup-card__radio');
form.querySelectorAll('input[name="accountType"]').forEach(function(input){
  input.addEventListener('change',function(){
    radios.forEach(function(r){r.classList.remove('signup-card__radio--selected')});
    var label=input.closest('.signup-card__radio');
    if(label){label.classList.add('signup-card__radio--selected');}
  });
});
form.onsubmit=function(e){
  e.preventDefault();
  rw.style.display='none';
  var n=document.getElementById('name').value.trim(),
      em=document.getElementById('email').value.trim(),
      p=document.getElementById('password').value,
      cp=document.getElementById('confirmPassword').value,
      ac=form.querySelector('input[name="accountType"]:checked').value;

  if(p!==cp||p.length<6){
    rf.srcdoc='<pre style="margin:0;padding:1rem;font-family:monospace">Password mismatch or too short</pre>';
    rw.style.display='block';
    return;
  }

  var btn=form.querySelector('button[type="submit"]');
  btn.disabled=true;
  btn.textContent='Creating account...';

  window.Sagittarum.auth.signup(n,em,p,ac)
    .then(function(res1){
      // Show backend raw response for signup
      rf.srcdoc='<pre style="margin:0;padding:1rem;font-family:monospace">'+(res1.raw||'')+'</pre>';
      rw.style.display='block';

      if(!res1.ok){
        btn.disabled=false;
        btn.textContent='Sign up';
        return Promise.reject(new Error('Signup failed'));
      }

      // After successful signup, request login token
      btn.textContent='Requesting login token...';
      return window.Sagittarum.auth.getToken(em,p);
    })
    .then(function(res2){
      // Show token (or error) in iframe
      rf.srcdoc='<pre style="margin:0;padding:1rem;font-family:monospace">'+(res2.raw||'')+'</pre>';
      rw.style.display='block';

      if(!res2.ok){
        btn.disabled=false;
        btn.textContent='Sign up';
        return;
      }

      // Store session with token for later validation
      var token=(res2.raw||'').trim();
      var user={
        id:'',
        username:(n||'').trim(),
        email:em,
        role:ac==='teacher'?'teacher':'student',
        name:(n||'').trim(),
        token:token
      };
      window.Sagittarum.session.saveSession(user);

      btn.textContent='Signed up';

      setTimeout(function(){
        location.href=user.role==='teacher'?'../teacher/':'../student/';
      },700);
    })
    .catch(function(){
      // Errors already surfaced in iframe; just reset button
      btn.disabled=false;
      btn.textContent='Sign up';
    });
}
})();
  </script>
</body>
</html>
